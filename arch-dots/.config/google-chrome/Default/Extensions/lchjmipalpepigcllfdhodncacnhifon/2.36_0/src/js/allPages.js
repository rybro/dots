var config={},allPages={error_check:function(){if(-1<document.body.style.backgroundImage.indexOf("errorlinks.png")){var a=document.createElement("dialog"),b=document.createElement("button"),c=document.createElement("button"),d;document.body.style.overflow="hidden";a.style.border="1px solid rgba(0, 0, 0, 0.3)";a.style.borderRadius="6px";a.style.boxShadow="0 3px 7px rgba(0, 0, 0, 0.3)";d=chrome.extension.getURL("/src/images/popup.png");a.style.backgroundImage="url('"+d+"')";a.style.backgroundColor=
"white";a.style.backgroundRepeat="no-repeat";a.style.backgroundPosition="center bottom";a.innerHTML="Error detected... redirect to history.php?<br>(popup generated by ChromeLL)<br><br>";b.innerText="Redirect";b.addEventListener("click",function(){window.location.href="https:"==window.location.protocol?"https://boards.endoftheinter.net/history.php?b":"http://boards.endoftheinter.net/history.php?b"});c.innerText="Close";c.addEventListener("click",function(){a.close()});a.appendChild(b);a.appendChild(c);
document.body.appendChild(a);a.showModal()}},notify_pm:function(){var a=document.getElementById("userbar_pms");a&&(new MutationObserver(function(){if("none"==a.style.display&&0!=config.pms)config.pms=0,chrome.runtime.sendMessage({need:"save",name:"pms",data:config.pms});else if("none"!=a.style.display){var b=parseInt(a.innerText.match(/\((\d+)\)/)[1]),c,d;b>config.pms&&(1===b?(c="New PM",d="You have 1 unread private message."):(c="New PMs",d="You have "+b+" unread private messages."),chrome.runtime.sendMessage({need:"notify",
title:c,message:d},function(a){console.log(a)}),config.pms=b,chrome.runtime.sendMessage({need:"save",name:"pms",data:config.pms}))}})).observe(a,{attributes:!0,childList:!0})},history_menubar:function(){var a=document.createElement("a");a.innerHTML="Message History";a.href=config.history_menubar_classic?"//boards.endoftheinter.net/history.php":"//boards.endoftheinter.net/topics/Posted";if("regular"===document.body.className){var b=document.createElement("span"),c=document.getElementsByClassName("menubar")[0];
b.innerHTML=" | ";c.insertBefore(a,c.getElementsByTagName("br")[0]);c.insertBefore(b,a)}else"classic"===document.body.className&&(b=document.createElement("br"),document.getElementsByClassName("classic3")[0].insertBefore(a,null),document.getElementsByClassName("classic3")[0].insertBefore(b,a))},float_userbar:function(){var a=document.createElement("div"),b=document.getElementsByClassName("userbar")[0],c=document.getElementsByClassName("menubar")[0];document.getElementsByClassName("body")[0].removeChild(b);
document.getElementsByClassName("body")[0].removeChild(c);a.insertBefore(c,null);a.insertBefore(b,null);a.style.position="fixed";a.style.width="100%";a.style.top="0";b.style.marginTop="-2px";b.style.borderBottomLeftRadius="5px";b.style.borderBottomRightRadius="5px";config.remove_links?document.getElementsByTagName("h1")[0].style.paddingTop="20px":document.getElementsByTagName("h1")[0].style.paddingTop="40px";document.getElementsByClassName("body")[0].insertBefore(a,null)},float_userbar_bottom:function(){var a=
document.getElementsByClassName("menubar")[0],b=document.getElementsByClassName("userbar")[0];a.style.position="fixed";a.style.width="99%";a.style.bottom="-2px";b.style.position="fixed";b.style.borderTopLeftRadius="5px";b.style.borderTopRightRadius="5px";b.style.width="99%";b.style.bottom="33px";a.style.marginRight="20px";a.style.zIndex="2";b.style.zIndex="2"},short_title:function(){document.title=document.title.replace(/End of the Internet - /i,"")},user_info_popup:function(){chrome.runtime.sendMessage({need:"insertcss",
file:"src/css/arrowbox.css"},function(a){a="PM GT BT HIGHLIGHT UNHIGHLIGHT IGNORATE".split(" ");var b=document.createElement("div");b.id="user-popup-div";var c=document.createElement("div");c.id="popup_info";var d=document.createElement("div");d.id="popup_user";for(var f,e=0,g;g=a[e];e++)f=document.createElement("span"),f.className="popup_link",f.innerHTML=g,f.addEventListener("click",commonFunctions.popupClick),c.insertBefore(f,null);b.insertBefore(d,null);b.insertBefore(c,null);document.body.insertBefore(b,
null);commonFunctions.hidePopup();document.addEventListener("click",function(a){"popup_link"!=a.target.className&&commonFunctions.hidePopup.call(commonFunctions,a)})})}},commonFunctions={cachedEvent:"",asyncUpload:function(a,b){console.log(a,b);b||(b=0);var c=new XMLHttpRequest;c.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var c=document.createElement("div");c.innerHTML=this.responseText;console.log(c);var e;e=window.location.href.match("postmsg")?document.getElementsByTagName("form")[0].getElementsByTagName("b")[2]:
document.getElementsByClassName("quickpost-body")[0].getElementsByTagName("b")[0];var d=e.innerHTML.match(/Uploading: (\d+)\/(\d+)\)/),c=c.getElementsByClassName("img")[0].getElementsByTagName("input")[0];c.value&&"<img"==c.value.substring(0,4)&&(commonFunctions.quickReplyInsert(c.value),e.innerHTML=b+1==d[2]?"Your Message":"Your Message (Uploading: "+(b+2)+"/"+d[2]+")");b++;b<a.length&&commonFunctions.asyncUpload(a,b)}};var d="https";-1==window.location.href.indexOf("https:")&&(d="http");c.open("post",
d+"://u.endoftheinter.net/u.php",!0);d=new FormData;d.append("file",a[b]);c.withCredentials="true";c.send(d)},handlePopup:function(){try{var a=commonFunctions.cachedEvent,b,c,d=document.body.scrollTop;b=a.x+document.body.scrollLeft;c=a.y+d;var f;"message-container"===a.target.parentNode.parentNode.parentNode.parentNode.className?(f=a.target.parentNode.parentNode.parentNode.parentNode.getElementsByTagName("a")[0],commonFunctions.currentPost=a.target.parentNode.parentNode.parentNode.parentNode.parentNode):
(f=a.target.parentNode.getElementsByTagName("a")[0],commonFunctions.currentPost=a.target.parentNode);commonFunctions.currentUser=f.innerHTML;commonFunctions.currentID=f.href.match(/user=(\d+)/)[1];a="";config.hide_gs||(22682<commonFunctions.currentID?a=" (gs)\u2076":21289<commonFunctions.currentID?a=" (gs)\u2075":20176<commonFunctions.currentID?a=" (gs)\u2074":15258<commonFunctions.currentID?a=" (gs)\u00b3":13498<commonFunctions.currentID?a=" (gs)\u00b2":10088<commonFunctions.currentID&&(a=" (gs)"));
var e=new XMLHttpRequest;e.open("GET",f,!0);e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var a=document.createElement("html");a.innerHTML=e.responseText;for(var b=a.getElementsByTagName("td"),c=0,d=b.length;c<d;c++){var f=b[c];if(-1<f.innerText.indexOf("Status"))var g=b[c+1].innerText;if(-1<f.innerText.indexOf("Formerly"))var h=b[c+1].innerText;if(-1<f.innerText.indexOf("Reputation"))var l=b[c+1].innerText}b=document.getElementById("namechange");c=document.getElementById("online");
d=document.getElementById("punish");document.getElementById("rep").innerHTML="<br>"+l;config.show_old_name&&h&&(b.innerHTML="<br>Formerly known as: <b>"+h+"</b>");-1<a.innerHTML.indexOf("online now")&&(c.innerHTML="(online now)");g&&(-1<g.indexOf("Suspended")&&(d.innerHTML="<b>Suspended until: </b>"+g.substring(17)),-1<g.indexOf("Banned")&&(d.innerHTML="<b>Banned</b>"))}};e.send();document.getElementById("popup_user").innerHTML='<div id="username">'+commonFunctions.currentUser+" "+a+' <span class="popup_uid">'+
commonFunctions.currentID+'</div><span class="popup_uid"><div id="namechange"> </div><span class="popup_uid"><p><div id="rep"><br>loading...</div></p><div id="online"></div><div id="punish"></div><div id="clip"></div></span>';var g=document.getElementById("user-popup-div");g.style.top=c+10+"px";g.style.left=b-30+"px";g.style.display="block";setTimeout(function(){document.addEventListener("mousemove",commonFunctions.mousemoveHandler)},500);document.selection?document.selection.empty():window.getSelection&&
window.getSelection().removeAllRanges()}catch(h){console.log(h)}},hidePopup:function(){document.getElementById("user-popup-div").style.display="none";document.removeEventListener("mousemove",this.mousemoveHandler)},mousemoveHandler:function(a){("message"==a.target.className||"message-container"==a.target.className||"message-top"==a.target.className||a.target.className.match(/bar/)||"body"==a.target.className)&&commonFunctions.hidePopup()},popupClick:function(a){var b=commonFunctions.currentUser.toLowerCase(),
c=!1;if("undefined"!==typeof messageList)var c=!0,d=document.getElementsByClassName("message-container"),f,e=messageList.functions.messagecontainer;else f=document.getElementsByTagName("tr"),e=topicList.functions;var g=a.target.innerHTML;config.debug&&console.log(g,commonFunctions.currentUser);switch(g){case "IGNORATE?":config.ignorator_list=config.ignorator_list&&""!=config.ignorator_list?config.ignorator_list+(", "+commonFunctions.currentUser):commonFunctions.currentUser;chrome.runtime.sendMessage({need:"save",
name:"ignorator_list",data:config.ignorator_list});if(c)for(messageList.config.ignorator_list=config.ignorator_list,b=0,c=d.length;b<c;b++)f=d[b],e.ignorator_messagelist(f);else for(topicList.config.ignorator_list=config.ignorator_list,topicList.createArrays(),b=1,c=f.length;b<c;b++)d=f[b],e.ignorator_topiclist(d,b);a.target.innerHTML="IGNORATE";commonFunctions.hidePopup();break;case "IGNORATE":a.target.innerHTML="IGNORATE?";break;case "PM":chrome.runtime.sendMessage({need:"opentab",url:"http://endoftheinter.net/postmsg.php?puser="+
commonFunctions.currentID});commonFunctions.hidePopup();break;case "GT":chrome.runtime.sendMessage({need:"opentab",url:"http://endoftheinter.net/token.php?type=2&user="+commonFunctions.currentID});commonFunctions.hidePopup();break;case "BT":chrome.runtime.sendMessage({need:"opentab",url:"http://endoftheinter.net/token.php?type=1&user="+commonFunctions.currentID});commonFunctions.hidePopup();break;case "HIGHLIGHT":config.user_highlight_data[b]={};config.user_highlight_data[b].bg=Math.floor(16777215*
Math.random()).toString(16);config.user_highlight_data[b].color=Math.floor(16777215*Math.random()).toString(16);chrome.runtime.sendMessage({need:"save",name:"user_highlight_data",data:config.user_highlight_data});if(c)for(messageList.config.user_highlight_data=config.user_highlight_data,b=0,c=d.length;b<c;b++)f=d[b],e.userhl_messagelist(f,b),config.foxlinks_quotes&&e.foxlinks_quote(f);else for(topicList.config.user_highlight_data=config.user_highlight_data,b=1,c=f.length;b<c;b++)d=f[b],e.userhl_topiclist(d);
break;case "UNHIGHLIGHT":delete config.user_highlight_data[commonFunctions.currentUser.toLowerCase()];chrome.runtime.sendMessage({need:"save",name:"user_highlight_data",data:config.user_highlight_data});if(c)for(messageList.config.user_highlight_data=config.user_highlight_data,f=document.getElementsByClassName("message-top"),b=0,c=f.length;b<c;b++){if(e=f[b],e.getElementsByTagName("a")[0]&&(a=e.getElementsByTagName("a")[0].innerHTML,a===commonFunctions.currentUser))for(e.style.background="",e.style.color=
"",e=e.getElementsByTagName("a"),a=0;a<e.length;a++)e[a].style.color=""}else for(topicList.config.user_highlight_data=config.user_highlight_data,b=1,c=f.length;b<c;b++)if(d=f[b],e=d.getElementsByTagName("td"),e[1].getElementsByTagName("a")[0]&&(a=e[1].getElementsByTagName("a")[0].innerHTML,a==commonFunctions.currentUser))for(a=0,d=e.length;a<d;a++){g=e[a];g.style.background="";g.style.color="";for(var g=g.getElementsByTagName("a"),h=0,k=g.length;h<k;h++)g[h].style.color=""}commonFunctions.hidePopup()}},
quickReplyInsert:function(a){for(var b=document.getElementsByTagName("textarea")[0],c=b.value.split("---"),d="",f=0;f<c.length-1;f++)d+=c[f];d+=a+"\n---"+c[c.length-1];b.value=d},init:function(){chrome.runtime.sendMessage({need:"config"},function(a){config=a.data;try{for(var b in allPages)if(config[b])allPages[b]()}catch(c){console.log("error in "+b+":",c)}})}};
function hideOptions(){var a=document.getElementById("options_div"),b=document.getElementsByClassName("body")[0];b.style.opacity=1;document.body.removeChild(a);b.removeEventListener("click",hideOptions);document.body.removeEventListener("click",hideOptions);document.body.removeEventListener("mousewheel",preventScroll)}function preventScroll(a){a.preventDefault()}
chrome.runtime.onMessage.addListener(function(a){if("showOptions"==a.action){var b=chrome.extension.getURL("options.html"),c=document.createElement("div");a=document.createElement("iframe");var d=window.innerWidth,f=window.innerHeight,e=document.createElement("a"),g=document.getElementsByClassName("body")[0];c.id="options_div";c.style.position="fixed";c.style.width=.95*d+"px";c.style.height=.95*f+"px";c.style.left=d-.975*d+"px";c.style.top=f-.975*f+"px";c.style.boxShadow="5px 5px 7px black";c.style.borderRadius=
"6px";c.style.opacity=1;c.style.backgroundColor="white";e.style.cssFloat="right";e.style.fontSize="18px";e.href="#";e.style.textDecoration="none";e.id="close_options";e.innerHTML="&#10006;";a.style.width="inherit";a.src=b;a.style.backgroundColor="white";a.style.border="none";g.style.opacity=.3;c.appendChild(e);c.appendChild(a);document.body.appendChild(c);b=2*e.getBoundingClientRect().height;a.style.height=.95*f-b+"px";g.addEventListener("click",hideOptions);document.getElementById("close_options").addEventListener("click",
hideOptions);document.body.addEventListener("mousewheel",preventScroll)}});"loading"===document.readyState?document.addEventListener("DOMContentLoaded",commonFunctions.init):commonFunctions.init();
