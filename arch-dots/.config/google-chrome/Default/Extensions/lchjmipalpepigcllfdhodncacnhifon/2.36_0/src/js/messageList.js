var messageList={init:function(a){this.config=a.data;this.config.tcs=a.tcs;this.prepareIgnoratorArray();this.globalPort=chrome.runtime.connect();this.globalPort.onMessage.addListener(this.handleEvent.ignoratorUpdate);window.location.href.match("inboxthread.php")&&(this.pm="_pm");this.config.dramalinks&&!this.pm&&chrome.runtime.sendMessage({need:"dramalinks"},function(a){dramalinks.html=a.data;dramalinks.config=messageList.config});"loading"==document.readyState?document.addEventListener("DOMContentLoaded",
function(){messageList.callFunctions.call(messageList,messageList.pm)}):this.callFunctions.call(this,this.pm)},functions:{messagecontainer:{eti_bash:function(a,b){var c=a.getElementsByClassName("message-top")[0];anchor=document.createElement("a");anchor.style.cssFloat="right";anchor.href="##bash";anchor.className="bash";anchor.id="bash_"+b;anchor.innerHTML="&#9744;";anchor.style.textDecoration="none";c.appendChild(anchor)},ignorator_messagelist:function(a,b){if(messageList.config.ignorator){var c=
a.getElementsByClassName("message-top"),d,e,f;messageList.topsTotal+=c.length;for(var g=0;g<c.length;g++)if(d=c[g]){e=d.getElementsByTagName("a")[0].innerHTML.toLowerCase();for(var h=0,k=messageList.ignores.length;h<k;h++)e==messageList.ignores[h]&&(f=0==g&&0<messageList.topsTotal?messageList.topsTotal-c.length:messageList.topsTotal-g,d.parentNode.style.display="none",messageList.config.debug&&console.log("removed post by "+messageList.ignores[h]),messageList.ignorated.total_ignored++,messageList.ignorated.data.users[messageList.ignores[h]]?
(messageList.ignorated.data.users[messageList.ignores[h]].total++,messageList.ignorated.data.users[messageList.ignores[h]].trs.push(f)):(messageList.ignorated.data.users[messageList.ignores[h]]={},messageList.ignorated.data.users[messageList.ignores[h]].total=1,messageList.ignorated.data.users[messageList.ignores[h]].trs=[f]),messageList.config.hide_ignorator_badge||messageList.globalPort.postMessage({action:"ignorator_update",ignorator:messageList.ignorated,scope:"messageList"}))}}},user_notes:function(a){messageList.config.usernote_notes||
(messageList.config.usernote_notes={});a=a.getElementsByClassName("message-top")[0];if(a.getElementsByTagName("a")[0].href.match(/user=(\d+)$/i)){var b=document.createElement("a");b.id="notebook";var c=document.createTextNode(" | ");a.appendChild(c);c=a.getElementsByTagName("a")[0].href.match(/user=(\d+)$/i)[1];b.innerHTML=void 0!=messageList.config.usernote_notes[c]&&""!=messageList.config.usernote_notes[c]?"Notes*":"Notes";b.href="##note"+c;a.appendChild(b)}},like_button:function(a,b){if(!window.location.href.match("archives")){var c=
a.getElementsByClassName("message-top")[0],d=document.createElement("a"),e=document.createTextNode(" | ");d.innerText="Like";d.className="like_button";d.href="##like";c.appendChild(e);c.appendChild(d);d.addEventListener("mouseenter",messageList.handleEvent.mouseenter.bind(messageList));d.addEventListener("mouseleave",messageList.handleEvent.mouseleave.bind(messageList))}},number_posts:function(a,b,c){a=a.getElementsByClassName("message-top")[0];c=window.location.href.match(/page=/)?window.location.href.match(/page=(\d+)/)[1]:
1;b+=50*(c-1);1E3>b&&(b="0"+b);100>b&&(b="0"+b);10>b&&(b="0"+b);b=document.createTextNode(" | #"+b);a.appendChild(b)},post_templates:function(a,b){var c=a.getElementsByClassName("message-top")[0],d,e,f;d=document.createElement("div");d.style.display="none";d.id="cdiv";document.body.appendChild(d,null);messageList.postEvent=document.createEvent("Event");messageList.postEvent.initEvent("postTemplateInsert",!0,!0);d=document.createElement("span");d.innerHTML=" | ";d.className="post_template_holder";
e=document.createElement("span");e.className="post_template_opts";e.innerHTML="[";f=document.createElement("a");f.href="##"+b;f.innerHTML="&gt;";f.className="expand_post_template";e.appendChild(f);e.innerHTML+="]";d.appendChild(e);c.appendChild(d)},userhl_messagelist:function(a,b,c){if(messageList.config.enable_user_highlight){b=a.getElementsByClassName("message-top");var d=a.getElementsByClassName("message-top")[0];if(messageList.config.no_user_highlight_quotes){if(f=d.getElementsByTagName("a")[0].innerHTML.toLowerCase(),
messageList.config.user_highlight_data[f]){messageList.config.debug&&console.log("highlighting post by "+f);d.style.background="#"+messageList.config.user_highlight_data[f].bg;d.style.color="#"+messageList.config.user_highlight_data[f].color;g=d.getElementsByTagName("a");h=0;for(k=g.length;h<k;h++)l=g[h],l.style.color="#"+messageList.config.user_highlight_data[f].color;c&&messageList.config.notify_userhl_post&&a.getElementsByClassName("message-top")[0].getElementsByTagName("a")[0].innerHTML!=document.getElementsByClassName("userbar")[0].getElementsByTagName("a")[0].innerHTML.replace(/ \((\d+)\)$/,
"")&&chrome.runtime.sendMessage({need:"notify",message:document.title.replace(/End of the Internet - /i,""),title:"Post by "+f},function(a){console.log(a)})}}else try{for(d=0;d<b.length;d++){var e=b[d],f=e.getElementsByTagName("a")[0].innerHTML.toLowerCase();if(messageList.config.user_highlight_data[f]){messageList.config.debug&&console.log("highlighting post by "+f);e.setAttribute("highlighted",!0);e.style.background="#"+messageList.config.user_highlight_data[f].bg;e.style.color="#"+messageList.config.user_highlight_data[f].color;
for(var g=e.getElementsByTagName("a"),h=0,k=g.length;h<k;h++){var l=g[h];l.style.color="#"+messageList.config.user_highlight_data[f].color}c&&messageList.config.notify_userhl_post&&0==d&&a.getElementsByClassName("message-top")[0].getElementsByTagName("a")[0].innerHTML!=document.getElementsByClassName("userbar")[0].getElementsByTagName("a")[0].innerHTML.replace(/ \((\d+)\)$/,"")&&chrome.runtime.sendMessage({need:"notify",message:document.title.replace(/End of the Internet - /i,""),title:"Post by "+
f},function(a){console.log(a)})}}}catch(n){messageList.config.debug&&console.log(n)}}},foxlinks_quotes:function(a){var b="#"+messageList.config.foxlinks_quotes_color;a=a.getElementsByClassName("quoted-message");if(a.length)for(var c,d=0,e=a.length;d<e;d++)if(c=a[d],quot_msg_style=c.style,quot_msg_style.borderStyle="solid",quot_msg_style.borderWidth="2px",quot_msg_style.borderRadius="5px",quot_msg_style.marginRight="30px",quot_msg_style.marginLeft="10px",quot_msg_style.paddingBottom="10px",quot_msg_style.marginTop=
"0px",quot_msg_style.borderColor=b,c=c.getElementsByClassName("message-top")[0])""==c.style.background?c.style.background=b:quot_msg_style.borderColor=c.style.background,c.style.marginTop="0px",c.style.paddingBottom="2px",c.style.marginLeft="-6px"},label_self_anon:function(a){if(-1<document.getElementsByTagName("h2")[0].innerHTML.indexOf("/topics/Anonymous")&&!window.location.href.match("archives")&&(a=a.getElementsByClassName("message-top"),!a[0].getElementsByTagName("a")[0].href.match(/user=(\d+)$/i))){var b=
document.getElementsByClassName("quickpost-body")[0].getElementsByTagName("a")[0].innerHTML;if(-1!=b.indexOf("Human #"))for(var c=0,d=a.length;c<d;c++){var e=a[c],f=e.getElementsByTagName("a")[0];if(-1<f.innerHTML.indexOf("Filter")){var f=e.getElementsByTagName("b")[0].nextSibling,g=f.nodeValue.substring(1,f.nodeValue.length),g=g.replace(" | ","");g==b&&(g=document.createElement("span"),g.innerHTML="<b>(Me)</b> | ",e.insertBefore(g,f.nextSibling))}else f.innerHTML==b&&(g=document.createElement("span"),
g.innerHTML=" | <b>(Me)</b>",e.insertBefore(g,f.nextSibling))}}},autoscroll_livelinks:function(a,b,c){c&&document.hidden&&messageList.autoscrollCheck(a)&&$.scrollTo(a)},autoscroll_livelinks_active:function(a,b,c){c&&!document.hidden&&messageList.autoscrollCheck(a)&&(setTimeout(function(){messageList.scrolling=!0;$.scrollTo(a,800)},10),setTimeout(function(){messageList.scrolling=!1},850))},post_title_notification:function(a,b,c){c&&("none"===a.style.display?messageList.config.debug&&console.log("not updating for ignorated post"):
a.getElementsByClassName("message-top")[0].getElementsByTagName("a")[0].innerHTML!=document.getElementsByClassName("userbar")[0].getElementsByTagName("a")[0].innerHTML.replace(/ \((\d+)\)$/,"")&&(a=1,b="",document.getElementsByClassName("message-container")[49]&&(b+="+"),document.title.match(/\(\d+\)/)?(a=parseInt(document.title.match(/\((\d+)\)/)[1]),document.title="("+(a+1)+b+") "+document.title.replace(/\(\d+\) /,"")):document.title="("+a+b+") "+document.title))},notify_quote_post:function(a,b,
c){if(c&&a.getElementsByClassName("quoted-message")&&a.getElementsByClassName("message-top")[0].getElementsByTagName("a")[0].innerHTML!=document.getElementsByClassName("userbar")[0].getElementsByTagName("a")[0].innerHTML.replace(/ \((\d+)\)$/,"")){b=!1;c=a.getElementsByClassName("quoted-message");for(var d=0,e=c.length;d<e;d++)c[d].getElementsByClassName("message-top")[0].getElementsByTagName("a")[0].innerHTML==document.getElementsByClassName("userbar")[0].getElementsByTagName("a")[0].innerHTML.replace(/ \((.*)\)$/,
"")&&"quoted-message"!=c[d].parentNode.className&&(b=!0);b&&chrome.runtime.sendMessage({need:"notify",title:"Quoted by "+a.getElementsByClassName("message-top")[0].getElementsByTagName("a")[0].innerHTML,message:document.title.replace(/End of the Internet - /i,"")},function(a){console.log(a)})}}},infobar:{imagemap_on_infobar:function(){var a=window.location.search.match(/(topic=)([0-9]+)/);if(a){var a=a[0],b=document.getElementsByClassName("infobar")[0],c=location.pathname,d=document.createElement("a"),
e=document.createTextNode(" | ");"/imagemap.php"==c&&a?(d.href="/showmessages.php?"+a,d.innerText="Back to Topic",b.appendChild(e),b.appendChild(d)):"/showmessages.php"==c&&(d.href="/imagemap.php?"+a,d.innerText="Imagemap",b.appendChild(e),b.appendChild(d))}},expand_spoilers:function(){var a=document.getElementsByClassName("infobar")[0];document.createElement("span");var b=document.createElement("a"),c=document.createTextNode(" | ");b.id="chromell_spoilers";b.href="##";b.innerText="Expand Spoilers";
a.appendChild(c);a.appendChild(b);b.addEventListener("click",messageList.spoilers.find)}},quickpostbody:{filter_me:function(){var a=document.getElementsByClassName("quickpost-body")[0],b=document.getElementsByClassName("infobar")[0];if(document.getElementsByClassName("message-top")[0].getElementsByTagName("a")[0].href.match(/user=(\d+)$/i))c="&u="+document.getElementsByClassName("userbar")[0].getElementsByTagName("a")[0].href.match(/\?user=([0-9]+)/)[1];else{if("archives.endoftheinter.net"==window.location.hostname)return;
if(a.getElementsByTagName("a")){c=a.getElementsByTagName("a")[0].innerText.replace("Human #","");if(isNaN(c))return;var c="&u=-"+c}}var a=window.location.href.match(/topic=([0-9]+)/)[1],d=document.createElement("a"),e=document.createTextNode(" | ");-1==window.location.href.indexOf(c)?(d.href=window.location.href.split("?")[0]+"?topic="+a+c,d.innerHTML="Filter Me"):(d.href=window.location.href.replace(c,""),d.innerHTML="Unfilter Me");b.appendChild(e);b.appendChild(d)},quick_imagemap:function(){var a=
document.getElementsByClassName("quickpost-body")[0];if(a){var b=document.createElement("button"),c=document.createTextNode(" "),d=document.createElement("input");b.textContent="Browse Imagemap";b.id="quick_image";d.placeholder="Search Imagemap...";d.id="image_search";a.appendChild(c);a.appendChild(b);a.appendChild(c);a.appendChild(d)}},post_before_preview:function(){for(var a=document.getElementsByClassName("quickpost-body")[0].getElementsByTagName("input"),b,c,d,e=0,f=a.length;e<f;e++)b=a[e],"preview"==
b.name&&(c=b),"post"==b.name&&(d=b);d.parentNode.removeChild(d);c.parentNode.insertBefore(d,c)},batch_uploader:function(){var a=document.getElementsByClassName("quickpost-body")[0],b=document.createElement("input"),c=document.createElement("input");b.type="file";b.multiple=!0;b.id="batch_uploads";c.type="button";c.value="Batch Upload";c.addEventListener("click",messageList.startBatchUpload);a.insertBefore(b,null);a.insertBefore(c,b)},quickpost_on_pgbottom:function(){chrome.runtime.sendMessage({need:"insertcss",
file:"src/css/quickpost_on_pgbottom.css"})},quickpost_tag_buttons:function(){if(!window.location.href.match("archives")){var a=document.getElementsByClassName("quickpost-body")[0];document.getElementById("u0_13");var b=document.createElement("input");b.value="Mod";b.name="Mod";b.type="button";b.id="mod";b.addEventListener("click",messageList.qpTagButton,!1);var c=document.createElement("input");c.value="Admin";c.name="Admin";c.type="button";c.addEventListener("click",messageList.qpTagButton,!1);c.id=
"adm";c=document.createElement("input");c.value="Quote";c.name="Quote";c.type="button";c.addEventListener("click",messageList.qpTagButton,!1);c.id="quote";var d=document.createElement("input");d.value="Spoiler";d.name="Spoiler";d.type="button";d.addEventListener("click",messageList.qpTagButton,!1);d.id="spoiler";var e=document.createElement("input");e.value="Preformated";e.name="Preformated";e.type="button";e.addEventListener("click",messageList.qpTagButton,!1);e.id="pre";var f=document.createElement("input");
f.value="Underline";f.name="Underline";f.type="button";f.addEventListener("click",messageList.qpTagButton,!1);f.id="u";var g=document.createElement("input");g.value="Italic";g.name="Italic";g.type="button";g.addEventListener("click",messageList.qpTagButton,!1);g.id="i";var h=document.createElement("input");h.value="Bold";h.name="Bold";h.type="button";h.addEventListener("click",messageList.qpTagButton,!1);h.id="b";a.insertBefore(b,a.getElementsByTagName("textarea")[0]);a.insertBefore(c,b);a.insertBefore(d,
c);a.insertBefore(e,d);a.insertBefore(f,e);a.insertBefore(g,f);a.insertBefore(h,g);a.insertBefore(document.createElement("br"),h)}},drop_batch_uploader:function(){-1<window.location.href.indexOf("postmsg.php")||-1<window.location.hostname.indexOf("archives")||document.getElementsByTagName("textarea")[0].addEventListener("drop",function(a){a.preventDefault();0==a.dataTransfer.files.length?console.log(a):(document.getElementsByClassName("quickpost-body")[0].getElementsByTagName("b")[0].innerHTML+=" (Uploading: 1/"+
a.dataTransfer.files.length+")",commonFunctions.asyncUpload(a.dataTransfer.files))})},snippet_listener:function(){if(-1==window.location.hostname.indexOf("archives")){var a=document.getElementsByName("message")[0],b;a.addEventListener("keydown",function(c){messageList.config.snippet_alt_key?!0==c.shiftKey&&"U+0009"==c.keyIdentifier&&(c.preventDefault(),b=messageList.snippet.findCaret(a),messageList.snippet.handler(a.value,b)):messageList.config.snippet_alt_key||"U+0009"!=c.keyIdentifier||(c.preventDefault(),
b=messageList.snippet.findCaret(a),messageList.snippet.handler(a.value,b))})}}},misc:{highlight_tc:function(){var a=messageList.tcs.getMessages(),b;if(a)for(var c=0,d=a.length;c<d;c++)b=a[c],messageList.config.tc_highlight_color&&(b.getElementsByTagName("a")[0].style.color="#"+messageList.config.tc_highlight_color)},label_tc:function(){var a=messageList.tcs.getMessages();if(a){var b=!1;messageList.config.tc_label_color&&""!=messageList.config.tc_label_color&&(b=!0);for(var c=0,d=a.length;c<d;c++){var e=
a[c],f=document.createElement("span"),g=document.createElement("b"),h=document.createTextNode("TC"),k=document.createTextNode(" | ");g.appendChild(h);b&&(g.style.color="#"+messageList.config.tc_label_color);f.appendChild(k);f.appendChild(g);username=e.getElementsByTagName("a")[0];username.outerHTML+=f.innerHTML}}},pm_title:function(){if(-1!=window.location.href.indexOf("inboxthread.php")){for(var a=document.getElementsByClassName("userbar")[0].getElementsByTagName("a")[0].innerText,b="",c=document.getElementsByClassName("message-top"),
d,e=0,f=c.length;e<f;e++)if(d=c[e],-1==d.getElementsByTagName("a")[0].innerText.indexOf(a)){b=d.getElementsByTagName("a")[0].innerText;break}document.title="PM - "+b}},post_title_notification:function(){document.addEventListener("visibilitychange",messageList.clearUnreadPosts);document.addEventListener("scroll",messageList.clearUnreadPosts);document.addEventListener("mousemove",messageList.clearUnreadPosts)},click_expand_thumbnail:function(a){a=a&&"string"!=typeof a?a.getElementsByClassName("message"):
document.getElementsByClassName("message");for(var b=0,c=a.length;b<c;b++)for(var d=a[b].getElementsByClassName("img-placeholder"),e=0;e<d.length;e++)messageList.image.observer.observe(d[e],{attributes:!0,childList:!0})},loadquotes:function(){function a(a,b,c){var d=[];null==b&&(b=document);null==c&&(c="*");b=b.getElementsByTagName(c);c=b.length;for(var e=0,n=0;e<c;e++)b[e].className==a&&(d[n]=b[e],n++);return d}function b(){this.style.cursor="pointer"}function c(){var b=this.id,c=document.createElement("span");
c.innerHTML="Loading message...";var e=new Image;e.src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///2Zm/9ra/o2N/mZm/6Cg/rOz/r29/iH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA==";
this.parentNode.insertBefore(c,this);this.parentNode.replaceChild(e,this);var k=new XMLHttpRequest;k.open("GET",d+"://boards.endoftheinter.net/message.php?"+b,!0);k.send(null);k.onreadystatechange=function(){if(4==k.readyState)if(200==k.status){var b=k.responseText,f=document.createElement("div");f.innerHTML=b;for(var b=a("message",f,null)[0],f=b.getElementsByTagName("script"),m=0;m<f.length;m++){var q=f[m].innerHTML.replace(/onDOMContentLoaded\(function\(\)\{new ImageLoader\(\$\("u0_1"\), "\\\/\\\//gi,
"").replace(/\\/gi,"").replace(/\)\}\)/gi,"").split(","),p=new Image;p.src=d+"://"+q[0].replace(/"$/gi,"");p.className="expandimagesLOL";f[m].parentNode.replaceChild(p,f[m]);m--}if(-1!=b.innerHTML.indexOf("---"))for(f=0;b.childNodes[f];){if(3==b.childNodes[f].nodeType&&-1!=b.childNodes[f].nodeValue.indexOf("---"))for(;b.childNodes[f];)b.removeChild(b.childNodes[f]);f++}c.parentNode.appendChild(b);e.parentNode.removeChild(e);c.parentNode.removeChild(c)}else alert("An error occurred loading the message. Fuck shit.")}}
var d=-1==document.location.href.indexOf("https")?"http":"https",e=0;window.setInterval(function(){var d=a("message-container",document.getElementById("u0_1"),"div").length;if(d>e){for(var g=a("quoted-message",document,"div"),h=0;h<g.length;h++)for(var k=g[h].getElementsByTagName("a"),l=0;l<k.length;l++)if("[quoted text omitted]"==k[l].innerHTML){k[l].removeAttribute("href");var n=k[l].parentNode.getAttribute("msgid").split(","),m=n[2].split("@");k[l].id="id="+m[0]+"&topic="+n[1]+"&r="+m[1];k[l].addEventListener("click",
c,!0);k[l].style.textDecoration="underline";k[l].title="Click to load the omitted message";k[l].addEventListener("mouseover",b,!0)}e=d}},1E3)},load_next_page:function(){document.getElementById("u0_3").addEventListener("dblclick",messageList.loadNextPage)}}},handleEvent:{ignoratorUpdate:function(a){if("ignorator_update"!==a.action)switch(a.action){case "showIgnorated":messageList.config.debug&&console.log("showing hidden msg",a.ids);for(var b=document.getElementsByClassName("message-top"),c=0;c<a.ids.length;c++)messageList.config.debug&&
console.log(b[a.ids[c]]),b[a.ids[c]].parentNode.style.display="block",b[a.ids[c]].parentNode.style.opacity=".7";break;default:messageList.config.debug&&console.log("invalid action",a)}},load:function(){this.parseObserver.disconnect();"archives.endoftheinter.net"==window.location.hostname&&this.functions.quickpostbody.filter_me();this.passToFunctions("misc");this.quote.addButtons();this.addListeners();this.appendScripts();this.addCSSRules();this.livelinks.observe(document.getElementById("u0_1"),{subtree:!0,
childList:!0});this.config.new_page_notify&&this.newPage.observe(document.getElementById("nextpage"),{attributes:!0})},newPost:function(a){var b=document.getElementsByClassName("message-container").length,c=this.functions.messagecontainer,d="";window.location.href.match("inboxthread")&&(d="_pm");for(var e in c)if(this.config[e+d])c[e](a,b,!0);this.addListeners(a);this.links.check(a);this.config.click_expand_thumbnail&&this.functions.misc.click_expand_thumbnail(a);this.config.hide_ignorator_badge||
this.globalPort.postMessage({action:"ignorator_update",ignorator:this.ignorated,scope:"messageList"})},mouseclick:function(a){this.config.post_templates&&this.postTemplateAction(a.target);if("notebook"==a.target.id)this.usernotes.open(a.target),a.preventDefault();else if("quick_image"==a.target.id)imagemap.init(),a.preventDefault();else if("like_button"==a.target.className)this.likeButton.process(a.target),a.preventDefault();else if("like_button_custom"==a.target.className){for(var b=a.target.id,
c=0,d=a.path.length;c<d;c++){var e=a.path[c];if("like_button"==e.className){this.likeButton.process(e,b);break}}a.preventDefault()}else 0===a.target.title.indexOf("/index.php")?(this.links.fix(a.target,"wiki"),a.preventDefault()):0===a.target.title.indexOf("/imap/")?(this.links.fix(a.target,"imagemap"),a.preventDefault()):a.target.className.match(/youtube|gfycat/)&&"DIV"==a.target.tagName?a.preventDefault():"archivequote"==a.target.className?(this.quote.handler(a),a.preventDefault()):"bash"==a.target.className&&
"true"!==a.target.getAttribute("ignore")?(a.target.className="bash_this",a.target.style.fontWeight="bold",a.target.innerHTML="&#9745;",this.bash.checkSelection(a.target),this.bash.showPopup(),a.preventDefault()):"bash_this"==a.target.className?(a.target.className="bash",a.target.style.fontWeight="initial",a.target.innerHTML="&#9744;",this.bash.checkSelection(a.target),a.preventDefault()):a.target.parentNode&&("embed"==a.target.parentNode.className?(this.youtube.embed(a.target.parentNode),a.preventDefault()):
"hide"==a.target.parentNode.className?(this.youtube.hide(a.target.parentNode),a.preventDefault()):"submitbash"==a.target.parentNode.id?(this.bash.handler(),a.preventDefault()):"embed_nws_gfy"==a.target.parentNode.className&&(b=a.target.parentNode.id.replace("_embed",""),this.gfycat.embed(document.getElementById(b)),a.preventDefault()))},mouseenter:function(a){"like_button"==a.target.className&&this.config.custom_like_button?(this.cachedEvent=a,this.menuDebouncer=setTimeout(this.likeButton.showOptions.call(this.likeButton),
250),a.preventDefault()):"username_anchor"==a.target.className&&this.config.user_info_popup&&(commonFunctions.cachedEvent=a,this.popupDebouncer=setTimeout(commonFunctions.handlePopup,750))},mouseleave:function(a){clearTimeout(this.menuDebouncer);clearTimeout(this.popupDebouncer);document.getElementById("hold_menu")&&(this.likeButton.hideOptions(),a.preventDefault())},search:function(){clearTimeout(this.imagemapDebouncer);this.imagemapDebouncer=setTimeout(function(){imagemap.search.init.call(imagemap.search)},
250)}},gfycat:{loader:function(){for(var a=document.getElementsByClassName("gfycat"),b=window.innerHeight,c=0,d=a.length;c<d;c++){var e=a[c],f=e.getBoundingClientRect();if(f.top>b+200||0>f.bottom){if("embedded"==e.getAttribute("name")||"embedded_thumb"==e.getAttribute("name"))e.getElementsByTagName("video")[0].paused||e.getElementsByTagName("video")[0].pause()}else"A"==e.tagName?"gfycat_thumb"==e.getAttribute("name")?messageList.gfycat.thumbnail(e):messageList.gfycat.placeholder(e):"placeholder"==
e.getAttribute("name")?messageList.gfycat.embed(e):"embedded"==e.getAttribute("name")&&e.getElementsByTagName("video")[0].paused&&e.getElementsByTagName("video")[0].play()}},checkAPI:function(a,b){var c="http://gfycat.com/cajax/get/"+a.split("/").slice(-1).join("/"),d;"https:"==window.location.protocol&&(d=!0,c=c.replace("http","https"));var e=new XMLHttpRequest;e.open("GET",c,!0);e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var a={},c=JSON.parse(e.responseText);c.gfyItem||b("error");
var h=c.gfyItem.width,k=c.gfyItem.height;messageList.config.resize_gfys&&h>messageList.config.gfy_max_width&&(k/=h/messageList.config.gfy_max_width,h=messageList.config.gfy_max_width);var l;l=d?c.gfyItem.webmUrl.replace("http","https"):c.gfyItem.webmUrl;a.nsfw=c.gfyItem.nsfw;a.height=k;a.width=h;a.webm=l;b(a)}};e.send()},placeholder:function(a){var b=a.getAttribute("href");this.checkAPI(b,function(c){"error"===c?a.className="l":messageList.config.hide_nws_gfycat?document.getElementsByTagName("h2")[0].innerHTML.match(/N[WL]S/)&&
(a.className="l"):messageList.gfycat.workSafe(a,c.nsfw,function(d){d?(d=document.createElement("div"),d.className="gfycat",d.id=c.webm,d.setAttribute("name","placeholder"),d.innerHTML='<video width="'+c.width+'" height="'+c.height+'" loop ></video><span style="display:none"><br><br>'+b+"</span>",a.parentNode&&(a.parentNode.replaceChild(d,a),d.getBoundingClientRect().top>window.innerHeight||messageList.gfycat.embed(d))):messageList.config.hide_nws_gfycat?a.className="l":messageList.gfycat.embedOnHover(a,
c.webm,c.width,c.height)})})},thumbnail:function(a){var b;messageList.config.show_gfycat_link?b="inline":b="none";var c=a.getAttribute("href"),d="http://thumbs.gfycat.com/"+c.split("/").slice(-1).join("/")+"-poster.jpg";this.checkAPI(c,function(e){"error"===e?a.className="l":messageList.config.hide_nws_gfycat?document.getElementsByTagName("h2")[0].innerHTML.match(/N[WL]S/)&&messageList.gfycat.embedOnHover(a,e.webm,e.width,e.height):messageList.gfycat.workSafe(a,e.nsfw,function(f){if(f){var g=document.createElement("div");
g.className="gfycat";g.id=e.webm;g.innerHTML='<img src="'+d+'" width="'+e.width+'" height="'+e.height+'"></img><span style="display:'+b+'"><br><br>'+c+"</span>";a.parentNode&&(a.parentNode.replaceChild(g,a),f=g.getElementsByTagName("img")[0],f.title="Click to play",f.addEventListener("click",function(a){a.preventDefault();g.innerHTML='<video width="'+e.width+'" height="'+e.height+'" loop ></video><span style="display:'+b+'"><br><br>'+c+"</span>";var d=g.getElementsByTagName("video")[0];g.setAttribute("name",
"embedded_thumb");d.src=g.id;d.title="Click to pause";d.play();d.addEventListener("click",function(a){d.title="Click to play/pause";d.paused?d.play():d.pause()})}))}else messageList.config.hide_nws_gfycat?a.className="l":messageList.gfycat.addHoverLink(a,e.webm,e.width,e.height)})})},workSafe:function(a,b,c){var d=document.getElementsByTagName("h2")[0],e=a.parentNode.innerHTML;d.innerHTML.match(/N[WL]S/)?c(!0):"1"===b||e.match(/(n[wl]s)/i)?(a.className="nws_gfycat",c(!1)):c(!0)},embedOnHover:function(a,
b,c,d){a.className="nws_gfycat";a.id=b;a.setAttribute("w",c);a.setAttribute("h",d);$(a).hoverIntent(function(){var a=$("table.message-body tr td.message").css("background-color");"nws_gfycat"==this.className&&$(this).append($("<span style='display: inline; position: absolute; z-index: 1; left: 100; background: "+a+";'><a id='"+b+"_embed'class='embed_nws_gfy' href='##'>&nbsp<b>[Embed NWS Gfycat]</b></a></span>"))},function(){"nws_gfycat"==this.className&&$(this).find("span").remove()})},embed:function(a){if("gfycat"===
a.className){var b=a.getElementsByTagName("video")[0];messageList.config.show_gfycat_link&&(a.getElementsByTagName("span")[0].style.display="inline");a.setAttribute("name","embedded");b.src=a.id;b.play()}else if("nws_gfycat"===a.className){var b=document.createElement("video"),c=a.getAttribute("w"),d=a.getAttribute("h");b.setAttribute("width",c);b.setAttribute("height",d);b.setAttribute("name","embedded");b.setAttribute("loop",!0);b.src=a.id;a.parentNode.replaceChild(b,a);b.play()}},pause:function(){if(document.hidden)for(var a=
document.getElementsByTagName("video"),b,c=0,d=a.length;c<d;c++)b=a[c],b.src&&!b.paused&&b.pause();else messageList.gfycat.loader()}},youtube:{embed:function(a){var b=document.getElementById(a.id);if("youtube"==b.className){var c=$("table.message-body tr td.message").css("background-color"),d;d=b.href;var e=d.match(/(\?|\&|#)(t=)/);if(e)var f=d.substring(e.index,d.length).match(/([0-9])+([h|m|s])?/g);d=(d=a.id.match(/^.*(youtu.be\/|v\/|u\/\w\/\/|watch\?v=|\&v=)([^#\&\?]*).*/))&&11==d[2].length?d[2]:
d;if(f){for(var g,h=e=0,k=f.length;h<k;h++)g=f[h],g.match(/([h|m|s])/)?-1<g.indexOf("h")?(g=Number(g.replace("h",""),10),e+=3600*g):-1<g.indexOf("m")?(g=parseInt(g.replace("m",""),10),e+=60*g):-1<g.indexOf("s")&&(e+=parseInt(g.replace("s",""),10)):e+=g;d+="?start="+e+"'"}a="<span style='display: inline; position: absolute; z-index: 1; left: 100; background: "+c+";'><a id='"+a.id+"' class='hide' href='#hide'>&nbsp<b>[Hide]</b></a></span><br><div class='youtube'><iframe id='yt"+a.id+"' type='text/html' width='640' height='390'src='https://www.youtube.com/embed/"+
d+"'?autoplay='0' frameborder='0'/></div>";$(b).find("span:last").remove();b.className="hideme";b.innerHTML+=a}},hide:function(a){a=document.getElementById(a.id);for(var b=a.childNodes.length,c;b--;)c=a.childNodes[b],"#text"!==c.nodeName&&"SPAN"!==c.tagName&&a.removeChild(c);a.className="youtube"}},snippet:{findCaret:function(a){var b=0;if(a.selectionStart||"0"==a.selectionStart)b=a.selectionStart;return b},handler:function(a,b){var c=a.substring(0,b),d,e,f,g=document.getElementsByName("message")[0];
-1<c.indexOf(" ")?(d=c.split(" "),d=d[d.length-1],-1<d.indexOf("\n")&&(d=d.split("\n"),d=d[d.length-1])):-1<c.indexOf("\n")?(d=c.split("\n"),d=d[d.length-1]):d=c;for(var h in messageList.config.snippet_data)h===d&&(e=messageList.config.snippet_data[h],f=c.lastIndexOf(d),f=c.substring(0,f),a=a.replace(c,f+e),g.value=a,e=a.lastIndexOf(e)+e.length,g.setSelectionRange(e,e))}},bash:{showPopup:function(){if(!document.getElementById("bash_popup")){var a=$("body, table.classic tr td").css("background-color"),
b=document.createElement("div");b.style.background=a;b.style.boxShadow="5px 5px 1.2em black";b.style.position="fixed";b.style.width=100;b.style.top=0;b.style.marginTop="-100%";b.id="bash_popup";b.innerHTML='<div><a id ="submitbash" href="##submitbash"><b>[Submit quote to ETI Bash]</b></a></div>';$("body").append(b);$(b).animate({"margin-top":"0"},{queue:!1,duration:200})}},checkSelection:function(a){var b=document.getElementById("bash_popup"),c=document.getElementsByClassName("bash_this"),d=c.length;
if(a){var e=document.getElementsByClassName("bash"),f=document.getElementsByClassName("message-container");a=a.id.match(/[0-9]+/)[0];quotes=f[a].getElementsByClassName("quoted-message");if(0<quotes.length)for(var g=0,h=e.length;g<h;g++)f=e[g],f.setAttribute("ignore","true"),f.style.opacity=.2;else if(0==quotes.length)for(g=0,h=e.length;g<h;g++)f=e[g],a=f.parentNode.parentNode,0<a.getElementsByClassName("quoted-message").length&&(f.setAttribute("ignore","true"),f.style.opacity=.2)}b&&(1<d?b.getElementsByTagName("a")[0].innerHTML=
"<b>[Submit quotes to ETI Bash]</b>":1===d?b.getElementsByTagName("a")[0].innerHTML="<b>[Submit quote to ETI Bash]</b>":0===d&&messageList.bash.reset(c))},reset:function(a){for(var b=document.getElementsByClassName("bash"),c,d=a.length;d--;)c=a[d],c.className="bash",c.className="bash",c.style.fontWeight="initial",c.innerHTML="[&nbsp&nbsp]";d=0;for(c=b.length;d<c;d++)a=b[d],a.removeAttribute("ignore"),a.style.opacity=1;messageList.bash.closePopup()},closePopup:function(){var a=document.getElementById("bash_popup");
$(a).animate({"margin-top":"-100%"},{queue:!1,duration:200});$(a).remove()},handler:function(){for(var a=document.getElementsByClassName("bash_this"),b,c,d,e,f,g=[],h=[],k,l=0,n=a.length;l<n;l++){b=a[l];e=b.parentNode.parentNode.getElementsByClassName("quoted-message");if(0<e.length){for(d=e.length;d--;)if(f=e[d],c=f.getElementsByClassName("message-top"),message=messageList.bash.getMessage(f,e,c,d))f=messageList.bash.getUsername(f.firstChild),h.push(f),g.push(message);d=b.parentNode.parentNode.getElementsByClassName("message-top")[0];
message_to_quote=d.nextSibling.lastChild.lastChild.firstChild;if(message=messageList.bash.getMessage(message_to_quote,e,c,-1))f=messageList.bash.getUsername(d),h.push(f),g.push(message)}else if(0===e.length){d=b.parentNode.parentNode.getElementsByClassName("message-top")[0];message=messageList.bash.getMessage(d.nextSibling.lastChild.lastChild.firstChild);if(!message){messageList.bash.reset(a);return}f=messageList.bash.getUsername(d);h.push(f);g.push(message)}0===l&&(b=b.parentNode.parentNode.getElementsByClassName("message-top")[0],
k=messageList.bash.getURL(b,n))}messageList.bash.submit(k,h,g);messageList.bash.reset(a)},getURL:function(a,b){for(var c=a.getElementsByTagName("a"),d,e,f=0,g=c.length;f<g;f++)if(d=c[f],-1<d.innerHTML.indexOf("Message Detail"))if(1===b)e=d.href;else if(1<b){d=d.href;e=d.match(/(topic=)([0-9]+)/);var h=e[0];e=d.match(/(id=)([0-9]+)/);e="http://"+window.location.hostname+"/showmessages.php?"+h+"#m"+e[2]}return e},getUsername:function(a){var b=a.getElementsByTagName("a")[0].innerHTML;if("Filter"==b||
"\u21d7"==b)b=a.innerHTML.match(/(Human\s#)([0-9]+)/)[0];return b},getMessage:function(a,b,c,d){if(b){a=a.innerText;for(var e,f=0,g=c.length;f<g;f++)e=c[f],a=a.replace(e.innerText,""),f!==d&&(e=b[f].innerText.replace(e.innerText,""),a=a.replace(e,""))}else a=a.innerText;b=a.lastIndexOf("---");-1<b&&(a=a.substring(0,b));a=a.replace("[quoted text omitted]","");return a.trim()},submit:function(a,b,c){console.log(a,b,c);if(b.length!==c.length)console.log("Error in submitBash function"),console.log(a,
b,c);else{var d=new FormData,e="";d.append("quotes_topic",a);d.append("quotes_user",b[0]);if(1<b.length){a=0;for(var f=b.length;a<f;a++)0<a&&(e+="<user>"+b[a]+"</user>\n",e+="<quote>\n"),e+=c[a]+"\n",e+="</quote>\n";d.append("quotes_content",e)}else 1===b.length&&d.append("quotes_content",c[0]);b=new XMLHttpRequest;b.open("POST","http://fuckboi.club/bash/submit-quote.php",!0);b.send(d)}}},usernotes:{open:function(a){var b=a.href.match(/note(\d+)$/i)[1];document.getElementById("notepage")?(a=document.getElementById("notepage"),
b=a.parentNode.getElementsByTagName("a")[0].href.match(/user=(\d+)$/i)[1],messageList.config.usernote_notes[b]=a.value,a.parentNode.removeChild(a),messageList.usernotes.save()):(b=messageList.config.usernote_notes[b],page=document.createElement("textarea"),page.id="notepage",page.value=void 0==b?"":b,page.style.width="100%",page.style.opacity=".6",a.parentNode.appendChild(page))},save:function(){chrome.runtime.sendMessage({need:"save",name:"usernote_notes",data:messageList.config.usernote_notes},
function(a){console.log(a)})}},quote:{handler:function(a){var b;b=a.likeButton?a.id:a.target.id;for(var c=document.querySelector('[msgid="'+b+'"]').childNodes,d,e,f,g="",h=0,k=c.length;h<k;h++){e=c[h];if(3===e.nodeType)if("---"!=e.nodeValue.replace(/^\s+|\s+$/g,""))g+=e.nodeValue;else break;e.tagName&&("B"==e.tagName||"I"==e.tagName||"U"==e.tagName?(d=e.tagName.toLowerCase(),g+="<"+d+">"+e.innerText+"</"+d+">"):"A"==e.tagName&&(g+=e.href));if(e.className)if("pr"==e.className)g+="<pre>"+e.innerHTML.replace(/<br>/g,
"")+"</pre>";else if("imgs"==e.className)for(imgNodes=e.getElementsByTagName("A"),e=0,d=imgNodes.length;e<d;e++)g+='<img imgsrc="'+imgNodes[e].getAttribute("imgsrc")+'" />\n';else if("spoiler_closed"==e.className)d=e.getElementsByClassName("caption")[0].innerText.replace(/<|\/>/g,""),e=e.getElementsByClassName("spoiler_on_open")[0].childNodes,g+=messageList.quote.returnSpoiler(d,e);else if("quoted-message"==e.className){var l="";d=e.attributes.msgid.value;f=e.getElementsByClassName("quoted-message");
if(0<f.length){for(var n=f.length;n--;)var m=f[n],m=messageList.quote.returnQuotes(m.childNodes,m.attributes.msgid.value),l=m[0]+l+m[1];m=messageList.quote.returnQuotes(e.childNodes,d);l=m[0]+l+m[1]}else m=messageList.quote.returnQuotes(e.childNodes,d),l=m[0]+m[1];g+=l}}g='<quote msgid="'+b+'">'+g+"</quote>";if(a.likeButton)return g;chrome.runtime.sendMessage({quote:g});messageList.quote.notify(a.target)},returnQuotes:function(a,b){var c=[];c[0]=b?'<quote msgid="'+b+'">':"<quote>";c[1]="";for(var d=
0,e=a.length;d<e;d++){var f=a[d];3===f.nodeType&&(c[1]+=f.nodeValue);f.tagName&&("B"==f.tagName||"I"==f.tagName||"U"==f.tagName?(tagName=f.tagName.toLowerCase(),c[1]+="<"+tagName+">"+f.innerText+"</"+tagName+">"):"A"===f.tagName&&(c[1]+=f.href));"pr"==f.className&&(c[1]+="<pre>"+f.innerHTML+"</pre>");if("imgs"==f.className)for(var g=f.getElementsByTagName("A"),h=0,k=g.length;h<k;h++)c[1]+='<img imgsrc="'+g[h].getAttribute("imgsrc")+'" />\n';"spoiler_closed"==f.className&&(g=f.getElementsByClassName("caption")[0].innerText.replace(/<|\/>/g,
""),f=f.getElementsByClassName("spoiler_on_open")[0].childNodes,c[1]+=messageList.quote.returnSpoiler(g,f))}c[1]+="</quote>";return c},returnSpoiler:function(a,b){for(var c="",d,e,f=1,g=b.length;f<g-1;f++)if(d=b[f],3===d.nodeType&&(c+=d.nodeValue),d.tagName&&("B"==d.tagName||"I"==d.tagName||"U"==d.tagName?(tagName=d.tagName.toLowerCase(),c+="<"+tagName+">"+d.innerText+"</"+tagName+">"):"A"===d.tagName&&(c+=d.innerText)),"imgs"==d.className){d=d.getElementsByTagName("A");for(var h=0,k=d.length;h<k;h++)e=
d[h],c+='<img imgsrc="'+e.getAttribute("imgsrc")+'" />\n'}return a?'<spoiler caption="'+a+'">'+c+"</spoiler>":"<spoiler>"+c+"</spoiler>"},notify:function(a){var b=$(a.parentNode).css("background-color");$(a).append($('<span id="copied"style="display: none; position: absolute; z-index: 1; left: 100; background: '+b+';">&nbsp<b>[copied to clipboard]</b></span>'));$("#copied").fadeIn(200);setTimeout(function(){$(a).find("span:last").fadeOut(400)},1500);setTimeout(function(){$(a).find("span:last").remove()},
2E3)},addButtons:function(){var a=window.location.hostname;window.location.search.replace("?topic=","");var b,c=[];if(-1<a.indexOf("archives")){document.getElementsByTagName("a");for(var a=document.getElementsByClassName("message"),d=document.getElementsByClassName("message-container"),e=0,f=d.length;e<f;e++){b=d[e];c[e]=b.getElementsByClassName("message-top")[0];b=a[e].getAttribute("msgid");var g=document.createElement("a"),h=document.createTextNode("Quote"),k=document.createTextNode(" | ");g.appendChild(h);
g.href="#";g.id=b;g.className="archivequote";c[e].appendChild(k);c[e].appendChild(g)}}}},image:{expand:function(a){var b=a.target.parentNode.parentNode.childNodes.length;if(1==b){messageList.config.debug&&console.log("first time expanding - build span, load img");b=document.createElement("span");b.setAttribute("class","img-loaded");b.setAttribute("id",a.target.parentNode.getAttribute("id")+"_expanded");var c=document.createElement("img"),d=a.target.parentNode.parentNode.getAttribute("imgsrc");"https:"==
window.location.protocol&&(d=d.replace(/^http:/i,"https:"));c.src=d;b.insertBefore(c,null);a.target.parentNode.parentNode.insertBefore(b,a.target.parentNode);a.target.parentNode.style.display="none"}else if(2==b)for(messageList.config.debug&&console.log("not first time expanding - toggle display status"),a=a.target.parentNode.parentNode.childNodes,b=0;b<a.length;b++)a[b].style.display="none"==a[b].style.display?"":"none";else messageList.config.debug&&console.log("I don't know what's going on with this image - weird number of siblings")},
resize:function(a){a.width*messageList.zoomLevel>messageList.config.img_max_width&&(a.height=a.height/(a.width/messageList.config.img_max_width)/messageList.zoomLevel,a.parentNode.style.height=a.height+"px",a.width=messageList.config.img_max_width/messageList.zoomLevel,a.parentNode.style.width=a.width+"px")},observer:new MutationObserver(function(a){for(var b=0;b<a.length;b++){var c=a[b];messageList.config.resize_imgs&&messageList.image.resize(c.target.childNodes[0]);"attributes"===c.type&&"class"==
c.attributeName&&"img-loaded"==c.target.getAttribute("class")&&c.target.childNodes[0].src.match(/.*\/i\/t\/.*/)&&(c.target.parentNode.addEventListener("click",messageList.image.expand),c.target.parentNode.setAttribute("class","thumbnailed_image"),c.target.parentNode.setAttribute("oldHref",c.target.parentNode.getAttribute("href")),c.target.parentNode.removeAttribute("href"))}})},spoilers:{find:function(a){a=document.getElementsByClassName("spoiler_on_close");for(var b,c=0;a[c];c++)b=a[c].getElementsByTagName("a")[0],
messageList.spoilers.toggle(b)},toggle:function(a){for(;!/spoiler_(?:open|close)/.test(a.className);)a=a.parentNode;a.className=-1!=a.className.indexOf("closed")?a.className.replace("closed","opened"):a.className.replace("opened","closed");return!1}},links:{check:function(a){a=(a||document).getElementsByClassName("l");for(var b={},c=a.length,d=/youtube|youtu.be/,e=/^.*(youtu.be\/|v\/|u\/\w\/\/|watch\?v=|\&v=)([^#\&\?]*).*/;c--;){var f=a[c];if(f.href.match(d)&&f.href.match(e)&&messageList.config.embed_on_hover)f.className=
"youtube",f.id=f.href+"&"+Math.random().toString(16).slice(2),$(f).hoverIntent(function(){var a=$("table.message-body tr td.message").css("background-color");"youtube"==this.className&&$(this).append($("<span style='display: inline; position: absolute; z-index: 1; left: 100; background: "+a+";'><a id='"+this.id+"' class='embed' href=#embed'>&nbsp<b>[Embed]</b></a></span>"))},function(){"youtube"==this.className&&$(this).find("span").remove()});else if(-1<f.href.indexOf("://lue.link/")&&messageList.config.full_link_names){if(!b[f.href]){var g=
"https://jsonp.nodejitsu.com/?url=http://urlex.org/json/"+f.href;b[f.href]=!0;$.getJSON(g,function(a){for(var b in a)for(var c=$('a[href="'+b+'"]'),d=0,e=c.length;d<e;d++)c[d].innerHTML=a[b]})}}else-1<f.title.indexOf("gfycat.com/")&&(messageList.config.embed_gfycat||messageList.config.embed_gfycat_thumbs)&&(f.className="gfycat",(messageList.config.embed_gfycat_thumbs||"quoted-message"==f.parentNode.className)&&f.setAttribute("name","gfycat_thumb"))}if(messageList.config.embed_gfycat||messageList.config.embed_gfycat_thumbs)messageList.gfycat.loader(),
window.addEventListener("scroll",messageList.gfycat.loader),document.addEventListener("visibilitychange",messageList.gfycat.pause)},fix:function(a,b){"wiki"===b?window.open(a.href.replace("boards","wiki")):"imagemap"===b&&window.open(a.href.replace("boards","images"))}},tcs:{getMessages:function(){messageList.config.tcs||(messageList.config.tcs={});var a=[],b=window.location.href.match(/topic=(\d+)/)[1],c=document.getElementsByClassName("message-top"),d,e;if(-1!==document.getElementsByClassName("message-top")[0].innerHTML.indexOf("> Human"))e=
!0,d="human #1";else if(window.location.href.match("page")&&!window.location.href.match("page=1($|&)")||window.location.href.match(/u=(\d+)/)){if(!messageList.config.tcs[b]){console.log("Unknown TC!");return}d=messageList.config.tcs[b].tc}else d=c[0].getElementsByTagName("a")[0].innerHTML.toLowerCase();messageList.config.tcs[b]||(messageList.config.tcs[b]={},messageList.config.tcs[b].tc=d,messageList.config.tcs[b].date=(new Date).getTime());for(b=0;b<c.length;b++)e&&-1==c[b].innerHTML.indexOf('">Human')&&
(c[b].innerHTML=c[b].innerHTML.replace(/Human #(\d+)/,'<a href="#'+b+'">Human #$1</a>')),c[b].getElementsByTagName("a")[0].innerHTML.toLowerCase()==d&&a.push(c[b]);messageList.tcs.save();return a},save:function(){var a=Infinity,b,c=0,d;for(d in messageList.config.tcs)messageList.config.tcs[d].date<a&&(b=d,a=messageList.config.tcs[d].date),c++;40<c&&delete messageList.config.tcs[b];chrome.runtime.sendMessage({need:"save",name:"tcs",data:messageList.config.tcs})}},likeButton:{process:function(a,b){var c,
d=a.parentNode.parentNode,e=a.parentNode.parentNode.getElementsByClassName("message")[0],f=document.getElementsByClassName("quickpost-nub")[0],g=document.getElementsByTagName("textarea")[0];if(document.getElementsByTagName("h2")[0].innerHTML.match("Anonymous")){c=!0;var h="Human",d="this"}else h=document.getElementsByClassName("userbar")[0].getElementsByTagName("a")[0].innerHTML.replace(/ \((-?\d+)\)$/,""),d=d.getElementsByTagName("a")[0].innerHTML;b?(c=messageList.config.custom_like_data[b].contents,
c=c.replace("[user]",h),c=c.replace("[poster]",d)):c=c?'<img src="http://i4.endoftheinter.net/i/n/f818de60196ad15c888b7f2140a77744/like.png" /> Human likes this post':'<img src="http://i4.endoftheinter.net/i/n/f818de60196ad15c888b7f2140a77744/like.png" /> '+h+" likes "+d+"'s post";var k=g.value,h=d="";if(k.match("---")){d=k.split("---");for(k=0;k<d.length-1;k++)h+=d[k];h+=c+"\n---"+d[d.length-1]}else h=k+c;e=e.getAttribute("msgid");e=messageList.quote.handler({id:e,likeButton:!0});g.value=e+"\n"+
h;0==document.getElementsByClassName("regular quickpost-expanded").length&&f.click()},showOptions:function(){if(!document.getElementById("hold_menu")){var a=messageList.config.custom_like_data,b=document.createElement("span");b.id="hold_menu";b.style.position="absolute";b.style.overflow="auto";b.style.padding="3px 3px";b.style.borderStyle="solid";b.style.borderWidth="2px";b.style.borderRadius="3px";b.style.backgroundColor=$(document.body).css("background-color");for(var c in a){var d=a[c].name,e=
c,f=b,g=document.createElement("span"),h=document.createElement("anchor"),k=document.createElement("br");g.className="unhigh_span";h.id=e;h.innerHTML="&nbsp"+d+"&nbsp";h.href="#like_custom_"+e;h.className="like_button_custom";g.appendChild(h);f.appendChild(g);f.appendChild(k)}messageList.cachedEvent.target.appendChild(b)}},hideOptions:function(){var a=document.getElementById("hold_menu");a?a.remove():console.log("no menu found")}},autoscrollCheck:function(a){var b=a.getBoundingClientRect();return"none"==
a.style.display||b.top>window.innerHeight?!1:!0},startBatchUpload:function(a){a=document.getElementById("batch_uploads");0==a.files.length?alert('Select files and then click "Batch Upload"'):(document.getElementsByClassName("quickpost-body")[0].getElementsByTagName("b")[0].innerHTML+=" (Uploading: 1/"+a.files.length+")",commonFunctions.asyncUpload(a.files,0))},postTemplateAction:function(a){if("expand_post_template"===a.className){var b=a.parentNode;b.removeChild(a);var c=document.createElement("a");
c.innerHTML="&lt;";c.className="shrink_post_template";c.href="##";b.innerHTML="[";b.insertBefore(c,null);for(var d in this.config.post_template_data){c=document.createElement("a");c.href="##"+d;c.className="post_template_title";c.innerHTML=d;var e=document.createElement("span");e.style.paddingLeft="3px";e.innerHTML="[";e.insertBefore(c,null);e.innerHTML+="]";e.className=d;b.insertBefore(e,null)}b.innerHTML+="]"}"shrink_post_template"===a.className&&(b=a.parentNode,a.parentNode.removeChild(a),c=document.createElement("a"),
c.innerHTML="&gt;",c.className="expand_post_template",c.href="##",b.innerHTML="[",b.insertBefore(c,null),b.innerHTML+="]");"post_template_title"===a.className&&(a.id="post_action",b=document.getElementById("cdiv"),d={},d.text=this.config.post_template_data[a.parentNode.className].text,b.innerText=JSON.stringify(d),b.dispatchEvent(this.postEvent))},clearUnreadPosts:function(a){document.title.match(/\(\d+\+?\)/)&&!0!=this.scrolling&&!document.hidden&&document.title.match(/\(\d+\+?\)/)&&(a=document.title.replace(/\(\d+\+?\) /,
""),document.title=a)},loadNextPage:function(){window.location.href.match("asyncpg")?parseInt(window.location.href.match("asyncpg=(d+)")[1]):window.location.href.match("page")&&parseInt(window.location.href.match("page=(d+)")[1]);window.location.href.match("topic=(d+)")},qpTagButton:function(a){if("INPUT"!=a.target.tagName)return 0;var b=a.target.id,c=/\*/m,d=document.getElementsByName("message")[0],e=d.scrollTop,f=d.value.substring(0,d.selectionStart),g=d.value.substring(d.selectionEnd,d.value.length),
h=d.value.substring(d.selectionStart,d.selectionEnd);d.selectionStart==d.selectionEnd?(c.test(a.target.value)?(a.target.value=a.target.name,a=d.selectionStart+b.length+3,d.value=f+"</"+b+">"+g):(a.target.value=a.target.name+"*",a=d.selectionStart+b.length+2,d.value=f+"<"+b+">"+g),d.selectionStart=a):(a=d.selectionStart+2*b.length+h.length+5,d.value=f+"<"+b+">"+h+"</"+b+">"+g,d.selectionStart=f.length);d.selectionEnd=a;d.scrollTop=e;d.focus()},addListeners:function(a){if(!a){document.body.addEventListener("click",
this.handleEvent.mouseclick.bind(this));var b=document.getElementById("image_search");b&&b.addEventListener("keyup",this.handleEvent.search.bind(this))}if(this.config.user_info_popup){a=a?a.getElementsByClassName("message-top"):document.getElementsByClassName("message-top");for(var b=0,c=a.length;b<c;b++){var d=a[b].getElementsByTagName("a")[0];d.className="username_anchor";-1<d.href.indexOf("http://endoftheinter.net/profile.php?user=")&&(d.addEventListener("mouseenter",this.handleEvent.mouseenter.bind(this)),
d.addEventListener("mouseleave",this.handleEvent.mouseleave.bind(this)))}}},appendScripts:function(){var a=document.getElementsByTagName("head")[0];if(messageList.config.post_templates){var b=document.createElement("script");b.type="text/javascript";b.src=chrome.extension.getURL("src/js/topicPostTemplate.js");a.appendChild(b)}},newPage:new MutationObserver(function(a){for(var b=0,c=a.length;b<c;b++){var d=a[b];"attributes"===d.type&&"block"===d.target.style.display&&chrome.runtime.sendMessage({need:"notify",
title:"New Page Created",message:document.title})}}),livelinks:new MutationObserver(function(a){for(var b=0,c=a.length;b<c;b++){var d=a[b];0<d.addedNodes.length&&0<d.addedNodes[0].childNodes.length&&"message-container"==d.addedNodes[0].childNodes[0].className&&messageList.handleEvent.newPost.call(messageList,d.addedNodes[0])}}),callFunctions:function(a){var b=document.getElementsByClassName("message-container"),c=this.functions.infobar,d=this.functions.messagecontainer,e=this.functions.quickpostbody,
f=this.functions.misc,g=this.config;this.zoomLevel=window.screen.width/document.documentElement.clientWidth;for(var h in c)if(g[h+a])c[h]();this.quote.addButtons();for(var c=4>b.length?b.length:4,k=0;k<c;k++){var l=b[k];for(h in d)if(g[h+a])d[h](l,k+1)}k=document.getElementsByTagName("h2")[0];g.dramalinks&&!g.hide_dramalinks_topiclist&&dramalinks.appendTo(k);if(4==c)for(k=4;l=b[k];k++)for(h in d)if(g[h+a])d[h](l,k+1);this.config.hide_ignorator_badge||this.globalPort.postMessage({action:"ignorator_update",
ignorator:this.ignorated,scope:"messageList"});for(var n in e)if(g[n+a])e[n]();this.addCSSRules();for(n in f)if(g[n+a])f[n]();this.links.check();this.addListeners();this.appendScripts();this.livelinks.observe(document.getElementById("u0_1"),{subtree:!0,childList:!0});this.config.new_page_notify&&this.newPage.observe(document.getElementById("nextpage"),{attributes:!0})},prepareIgnoratorArray:function(){this.ignores=this.config.ignorator_list.split(",");for(var a=0,b=this.ignores.length;a<b;a++){var c=
this.ignores[a].toLowerCase().trim();this.ignores[a]=c}},addCSSRules:function(){var a=document.styleSheets[0];a.insertRule(".like_button_custom { opacity: 0.5; }",1);a.insertRule(".like_button_custom:hover { opacity: 1.0; }",1);a.insertRule("#loading_image { -webkit-animation:spin 2s linear infinite; }",1);a.insertRule("@-webkit-keyframes spin { 100% { -webkit-transform:rotate(360deg); } }",1)},config:[],ignores:{},scrolling:!1,topsTotal:0,containersTotal:0,imagemapDebouncer:"",menuDebouncer:"",zoomLevel:1,
ignorated:{total_ignored:0,data:{users:{}}},pm:""};chrome.runtime.sendMessage({need:"config",tcs:!0},function(a){messageList.init.call(messageList,a)});
